{% extends "ti_base.html" %}
{% block headscript %}
{{ block.super }}
{% load staticfiles %}
<script src="{% static 'js/bootstrap-button.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.quickselect.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'css/jquery.quickselect.css' %}" />
<script type="text/javascript">
    $(function(){
	    $('#add-submit').click(function () {
			$.post("/ti/user/create/", $("#add-form").serialize(), function (html) {
				if(html=="success"){
					document.getElementById('add-feedback-alert').innerHTML = "<div class='alert alert-success'><button class='close' data-dismiss='alert'>×</button><strong>Succeeded:</strong> adding column.</div>";
				}
				else{
					document.getElementById('add-feedback-alert').innerHTML = "<div class='alert alert-error'><button class='close' data-dismiss='alert'>×</button><strong>Failed:</strong> " + html + "</div>";
				}
			}  , "html");
			return false;
		});
		$('#edit-submit').click(function () {
			$.post("/ti/user/change/", $("#edit-form").serialize(), function (html) {
				if(html=="success"){
					document.getElementById('edit-feedback-alert').innerHTML = "<div class='alert alert-success'><button class='close' data-dismiss='alert'>×</button><strong>Succeeded:</strong> changing column.</div>";
				}
				else{
					document.getElementById('edit-feedback-alert').innerHTML = "<div class='alert alert-error'><button class='close' data-dismiss='alert'>×</button><strong>Failed:</strong> " + html + "</div>";
				}
            }  , "html");
			return false;
		});
		$('#netid').quickselect({
			ajax:'/ti/user/get/',  
			match:'substring',
			autoSelectFirst:false,
			mustMatch:true,
			additionalFields:[$('#fname'), $('#lname'), $('#uin'), $('#group'), $('#enrolled'), $('#year'), $('#degree'), $('#major')],
			formatItem:function(data, index, total){return data[0]}
		});
    });
    function addGroup() {
        var group_name = document.getElementById('new_group').value;
        if(group_name==""){
            alert("Please enter the group name.");
        }
        else{
            $.getJSON("/ti/group/create/", { gname: group_name }, function(json){
                      var result = json['status']; 
                      if(result == "all succeeded"){
                      var select = document.getElementById('group');
                      select.options[select.options.length] = new Option(group_name, select.options.length);
                      select.options[select.options.length-1].selected = true;
                      document.getElementById('new_group').value = "";
                      alert("All succeeded.");
                      }
                      else{
                      alert("Failed adding a new group.");
                      }
                });
        }
    }
    function showNewDiv(){
    	document.getElementById('new-group-div').innerHTML = "<div class='alert'><button class='close' data-dismiss='alert'>×</button><fieldset><legend>New Group</legend><label for='new_group'>Group Name:</label><input type='text' name='new_group' id='new_group'/><label>Access Control:</label><div class='btn-group' data-toggle='buttons-checkbox'><button class='btn' onclick='return false;'>Person</button><button class='btn' onclick='return false;'>Group</button><button class='btn' onclick='return false;'>Column</button></div><br /><button onclick='addGroup(); return false;' class='btn btn-info'>Add Group</button></fieldset></div>";
    }
</script>
{% endblock %}
{% block sidebar %}
<ul class="nav nav-pills nav-stacked">
    <li><a href="/ti/">Home</a></li>
    <li class="active"><a href="/ti/user/">User</a></li>
    <li><a href="/ti/column/">Column</a></li>
    <li><a href="/ti/grade/">Grade</a></li>
</ul>
{% endblock %}
{% block content %}
<div class="row-fluid">
    <div class="span8">
        <div class="tabbable">
            <ul class="nav nav-tabs">
                <li class="active"><a href="#tab1" data-toggle="tab">Add User</a></li>
                <li><a href="#tab2" data-toggle="tab">Edit User</a></li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane active" id="tab1">
					<div class="alert alert-info">
						<button class="close" data-dismiss="alert">×</button>
						<strong>Tip:</strong> (*) sign indicates required fields.
					</div>
					<div id="add-feedback-alert">
					</div>
                    <form action="/ti/user/create/" method="post" class="well" id="add-form">
                        <div class="row-fluid">
                            <div class="span6">
                                <fieldset id="pi">
                                    <legend>Personal Information</legend>
                                    <label for="fname">First Name:</label>
                                    <input type="text" name="fname" id="fname" />
                                    <br />
                                    <label for="lname">Last Name:</label>
                                    <input type="text" name="lname" id="lname" />
                                    <br />
                                    <label for="netid">Net ID: (*)</label>
                                    <input type="text" name="netid" id="netid" />
                                    <br />
                                    <label for="uin">UIN: (*)</label>
                                    <input type="text" name="uin" id="uin" />
                                    <br />
                                    <label for="group">Group:</label>
                                    <select name="group" id="group">
                                        {% for g in group_info.result %}
                                        <option value="{{ g.name }}">{{ g.name }}</option>
                                        {% endfor %}
                                    </select>
                                    <a href="javascript:showNewDiv();">new</a>
                                </fieldset>
                            </div>
                            <div class="span6">
                                <div id="ai">
                                    <fieldset>
                                        <legend>Academic Information</legend>
                                        <label for="enrolled">Enrolled:</label>
                                        <select name="enrolled" id="enrolled">
                                            <option value="0" selected="selected">No</option>
                                            <option value="1">Yes</option>
                                        </select>
                                        <br />
                                        <label for="year">Year:</label>
                                        <input type="text" name="year" id="year" />
                                        <br />
                                        <label for="degree">Degree:</label>
                                        <input type="text" name="degree" id="degree" />
                                        <br />
                                        <label for="major">Major:</label>
                                        <input type="text" name="major" id="major" />
                                    </fieldset>
                                </div>
                            </div>
                        </div>
                        <div id="new-group-div"></div>
                        <div class="form-actions to-form-right">
                        	<input type="reset" value="Reset" class="btn"/>
							<input type="submit" value="Create" class="btn btn-primary" id="add-submit"/>
						</div>
                    </form>
                </div>
                <div class="tab-pane" id="tab2">
                    <div class="alert alert-info">
						<button class="close" data-dismiss="alert">×</button>
						<strong>Tip:</strong> (*) sign indicates required fields.
					</div>
					<div id="edit-feedback-alert">
					</div>
					<form action="/ti/user/change/" method="post" class="well" id="edit-form">
						<div class="row-fluid">
							<div class="span6">
								<label for="netid">NetID</label> <input type="text" name="netid" id="netid" />
								<br />
								<fieldset id="pi">
									<legend>Personal Information</legend>
									<label for="fname">First Name:</label>
									<input type="text" name="fname" id="fname" />
									<br />
									<label for="lname">Last Name:</label>
									<input type="text" name="lname" id="lname" />
									<br />
									<label for="uin">UIN: (*)</label>
									<input type="text" name="uin" id="uin" />
									<br />
									<label for="group">Group:</label>
									<select name="group" id="group">
										{% for g in group_info.result %}
										<option value="{{ g.name }}">{{ g.name }}</option>
										{% endfor %}
									</select>
									<br />
								</fieldset>
							</div>
							<div class="span6">
								<div id="ai">
									<fieldset>
										<legend>Academic Information</legend>
										<label for="enrolled">Enrolled:</label>
										<select name="enrolled" id="enrolled">
											<option value="0">No</option>
											<option value="1">Yes</option>
										</select>
										<br />
										<label for="year">Year:</label>
										<input type="text" name="year" id="year" />
										<br />
										<label for="degree">Degree:</label>
										<input type="text" name="degree" id="degree" />
										<br />
										<label for="major">Major:</label>
										<input type="text" name="major" id="major" />
									</fieldset>
								</div>
							</div>
						</div>
						<div class="form-actions to-form-right">
							<input type="reset" value="Reset" class="btn"/>
							<input type="submit" value="Change" class="btn btn-primary" id="edit-submit"/>
						</div>
					</form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}